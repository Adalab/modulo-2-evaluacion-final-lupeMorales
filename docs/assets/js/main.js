"use strict";const inputSearch=document.querySelector(".js-inputSearch"),foundMovies=document.querySelector(".js-foundMovies"),favoriteMovie=document.querySelector(".js-favoriteMovies"),btnSearch=document.querySelector(".js-btnSearch"),btnResetSearch=document.querySelector(".js-resetSearch"),btnRemoveMyMovies=document.querySelector(".js-btnRemoveAll"),imgWrong="https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png",imgDefault="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",warnings=document.querySelector(".js-warning"),removeMsg=()=>warnings.innerHTML="";let filmList=[],myMovies=[],selectedCard=[];function callFetch(){fetch("https://api.jikan.moe/v4/anime?q="+inputSearch.value).then(e=>e.json()).then(e=>{console.log(e),filmList=e.data,renderFilmList()}).catch(e=>{console.log("Se ha producido un error "+e)})}function renderFilmList(){let e="",i="";filmList.forEach(n=>{const t=selectedCard.findIndex(e=>n.mal_id===e.mal_id);i=-1!==t?"selected":"",n.images.jpg.image_url===imgWrong?e+=`<li class="film-card js-filmCard  ${i}" id=${n.mal_id}>\n    <img src="${imgDefault}" />\n            <h3 >${n.title}</h3>\n                </li>`:e+=`<li class="film-card js-filmCard  ${i} " id=${n.mal_id}>\n      <img src="${n.images.jpg.image_url}" />\n              <h3 >${n.title}</h3>\n                  </li>`}),foundMovies.innerHTML=e,listenerFilm()}function renderMyMovies(){let e="";myMovies.forEach(i=>{i.images.jpg.image_url===imgWrong?e+=`<li class="film-card js-favCard" id=${i.mal_id}>\n    <img src="${imgDefault}" />\n            <h3 >${i.title}</h3>\n                </li>`:e+=`<li class="film-card js-favCard " id=${i.mal_id}>\n      <img src="${i.images.jpg.image_url}" />\n              <h3 >${i.title}</h3>\n              </li>`}),favoriteMovie.innerHTML=e,listenerFavorites()}function removeMyFavorites(){myMovies=[],selectedCard=[],favoriteMovie.innerHTML="",renderFilmList(),saveMyFavorites(),saveSelectedCards()}function saveSelectedCards(){localStorage.setItem("selectedCards",JSON.stringify(selectedCard))}function loadSelectedCars(){const e=JSON.parse(localStorage.getItem("selectedCards"));null!==e&&(selectedCard=e,console.log("cargando seleccionados"),renderFilmList())}function saveMyFavorites(){localStorage.setItem("favoriteMovies",JSON.stringify(myMovies))}function loadMyFavorites(){const e=JSON.parse(localStorage.getItem("favoriteMovies"));null!==e&&(myMovies=e,console.log("cargando favoritos"),renderMyMovies())}function validateInput(){""===inputSearch.value?(btnSearch.disabled=!0,warnings.innerHTML="Introduce un título",setTimeout(removeMsg,3e3)):(btnSearch.disabled=!1,warnings.innerHTML="")}function notFound(){const e=filmList.find(e=>inputSearch.value);console.log("result",e),void 0===e&&(warnings.innerHTML="Título no encontrado",setInterval(removeMsg,3e3))}function pressEnter(e){if(13===e.keyCode)return e.preventDefault(),callFetch(),!1}function listenerFilm(){const e=document.querySelectorAll(".js-filmCard");for(const i of e)i.addEventListener("click",handleClickFilm)}function listenerFavorites(){const e=document.querySelectorAll(".js-favCard");for(const i of e)i.addEventListener("click",handleClickFavorite)}function handleClickSearch(e){e.preventDefault(),validateInput(),!1===btnSearch.disabled&&(callFetch(),notFound())}function handleClickResetInput(e){e.preventDefault(),inputSearch.value="",foundMovies.innerHTML=""}function handleClickFilm(e){const i=parseInt(e.currentTarget.id),n=filmList.find(e=>e.mal_id===i);-1===myMovies.findIndex(e=>e.mal_id===n.mal_id)&&(myMovies.push(n),selectedCard.push(n)),renderFilmList(),renderMyMovies(),saveMyFavorites(),saveSelectedCards(),console.log(selectedCard)}function handleClickFavorite(e){const i=parseInt(e.currentTarget.id),n=myMovies.findIndex(e=>e.mal_id===i),t=selectedCard.findIndex(e=>e.mal_id===n);myMovies.splice(n,1),selectedCard.splice(t,1),renderFilmList(),renderMyMovies()}btnSearch.disabled=!1,btnResetSearch.addEventListener("click",handleClickResetInput),btnSearch.addEventListener("click",handleClickSearch),btnRemoveMyMovies.addEventListener("click",removeMyFavorites),inputSearch.addEventListener("keydown",pressEnter),loadMyFavorites(),loadSelectedCars();