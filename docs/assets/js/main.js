"use strict";const inputSearch=document.querySelector(".js-inputSearch"),foundMovies=document.querySelector(".js-foundMovies"),favoriteMovie=document.querySelector(".js-favoriteMovies"),btnSearch=document.querySelector(".js-btnSearch"),btnResetSearch=document.querySelector(".js-resetSearch"),btnRemoveMyMovies=document.querySelector(".js-btnRemoveAll"),imgWrong="https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png",imgDefault="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",warnings=document.querySelector(".js-warning"),removeMsg=()=>warnings.innerHTML="";let filmList=[],myMovies=[],selectedCard=[];function callFetch(){fetch("https://api.jikan.moe/v4/anime?q="+inputSearch.value).then(e=>e.json()).then(e=>{console.log(e),filmList=e.data,notFound(),renderFilmList()}).catch(e=>{console.log("Se ha producido un error "+e)})}function renderFilmList(){let e="",i="";filmList.forEach(t=>{const n=selectedCard.findIndex(e=>t.mal_id===e.mal_id);i=-1!==n?"selected":"",t.images.jpg.image_url===imgWrong?e+=`<li class="film-card js-filmCard  ${i}" id=${t.mal_id}>\n    <img src="${imgDefault}" />\n            <h3 >${t.title}</h3>\n                </li>`:e+=`<li class="film-card js-filmCard  ${i} " id=${t.mal_id}>\n      <img src="${t.images.jpg.image_url}" />\n              <h3 >${t.title}</h3>\n                  </li>`}),foundMovies.innerHTML=e,listenerFilm()}function renderMyMovies(){let e="";myMovies.forEach(i=>{i.images.jpg.image_url===imgWrong?e+=`<li class="film-card js-favCard" id=${i.mal_id}>\n    <img src="${imgDefault}" />\n            <h3 >${i.title}</h3>\n                </li>`:e+=`<li class="film-card js-favCard " id=${i.mal_id}>\n      <img src="${i.images.jpg.image_url}" />\n              <h3 >${i.title}</h3>\n              </li>`}),favoriteMovie.innerHTML=e,listenerFavorites()}function removeMyFavorites(){myMovies=[],selectedCard=[],favoriteMovie.innerHTML="",renderFilmList(),saveMyFavorites(),saveSelectedCards()}function saveSelectedCards(){localStorage.setItem("selectedCards",JSON.stringify(selectedCard))}function loadSelectedCars(){const e=JSON.parse(localStorage.getItem("selectedCards"));null!==e&&(selectedCard=e,renderFilmList())}function saveMyFavorites(){localStorage.setItem("favoriteMovies",JSON.stringify(myMovies))}function loadMyFavorites(){const e=JSON.parse(localStorage.getItem("favoriteMovies"));null!==e&&(myMovies=e,renderMyMovies())}function validateInput(){""===inputSearch.value?(btnSearch.disabled=!0,warnings.innerHTML="Introduce un título",setTimeout(removeMsg,3e3)):(btnSearch.disabled=!1,warnings.innerHTML="")}function notFound(){0===filmList.filter(e=>e.title.toLowerCase().includes(inputSearch.value.toLowerCase())).length?(warnings.innerHTML="Título no encontrado",setTimeout(removeMsg,3e3)):warnings.innerHTML=""}function listenerFilm(){const e=document.querySelectorAll(".js-filmCard");for(const i of e)i.addEventListener("click",handleClickFilm)}function listenerFavorites(){const e=document.querySelectorAll(".js-favCard");for(const i of e)i.addEventListener("click",handleClickFavorite)}function pressEnter(e){if(13===e.keyCode)return e.preventDefault(),validateInput(),!1===btnSearch.disabled&&callFetch(),!1}function handleClickSearch(e){e.preventDefault(),validateInput(),!1===btnSearch.disabled&&callFetch()}function handleClickResetInput(e){e.preventDefault(),inputSearch.value="",foundMovies.innerHTML=""}function handleClickFilm(e){const i=parseInt(e.currentTarget.id),t=filmList.find(e=>e.mal_id===i);-1===myMovies.findIndex(e=>e.mal_id===t.mal_id)&&(myMovies.push(t),selectedCard.push(t)),renderFilmList(),renderMyMovies(),saveMyFavorites(),saveSelectedCards()}function handleClickFavorite(e){const i=parseInt(e.currentTarget.id),t=myMovies.findIndex(e=>e.mal_id===i),n=selectedCard.findIndex(e=>e.mal_id===t);myMovies.splice(t,1),selectedCard.splice(n,1),renderFilmList(),renderMyMovies()}btnSearch.disabled=!1,btnResetSearch.addEventListener("click",handleClickResetInput),btnSearch.addEventListener("click",handleClickSearch),btnRemoveMyMovies.addEventListener("click",removeMyFavorites),inputSearch.addEventListener("keydown",pressEnter),loadMyFavorites(),loadSelectedCars();