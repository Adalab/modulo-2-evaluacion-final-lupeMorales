"use strict";const inputSearch=document.querySelector(".js-inputSearch"),foundMovies=document.querySelector(".js-foundMovies"),favoriteMovie=document.querySelector(".js-favoriteMovies"),btnSearch=document.querySelector(".js-btnSearch"),btnResetSearch=document.querySelector(".js-resetSearch"),btnRemoveMyMovies=document.querySelector(".js-btnRemoveAll"),imgWrong="https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png",imgDefault="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",warnings=document.querySelector(".js-warning");let filmList=[],myMovies=[];function callFetch(){fetch("https://api.jikan.moe/v4/anime?q="+inputSearch.value).then(e=>e.json()).then(e=>{filmList=e.data.map(e=>({id:e.mal_id,title:e.title,images:e.images})),notFound(),renderFilmList()}).catch(e=>{console.log("Se ha producido un error "+e),console.log("no mi siela, esto no tendría que salir")})}function renderFilmList(){let e="",i="";filmList.forEach(n=>{const t=myMovies.findIndex(e=>n.id===e.id);i=-1!==t?"selected":"",n.images.jpg.image_url===imgWrong?e+=`<li class="film-card js-filmCard  ${i}" id=${n.id} title="click para seleccionar">\n    <img src="${imgDefault}" />\n            <h3 >${n.title}</h3>\n           \n                </li>`:e+=`<li class="film-card js-filmCard  ${i} " id=${n.id} title="click para seleccionar">\n      <img src="${n.images.jpg.image_url}" />\n              <h3 >${n.title}</h3>\n          \n                  </li>`}),foundMovies.innerHTML=e,listenerFilm()}function renderMyMovies(){let e="";myMovies.forEach(i=>{i.images.jpg.image_url===imgWrong?e+=`<li class="film-card js-favCard" id=${i.id} title="click para eliminar">\n    <img src="${imgDefault}" />\n            <h3 >${i.title}</h3>\n                </li>`:e+=`<li class="film-card js-favCard " id=${i.id} title="click para eliminar">\n      <img src="${i.images.jpg.image_url}" />\n              <h3 >${i.title}</h3>\n              </li>`}),favoriteMovie.innerHTML=e,listenerFavorites()}function removeMyFavorites(){myMovies=[],favoriteMovie.innerHTML="",""!==foundMovies.innerHTML?(renderFilmList(),saveMyFavorites()):saveMyFavorites()}function saveMyFavorites(){localStorage.setItem("favoriteMovies",JSON.stringify(myMovies))}function loadMyFavorites(){const e=JSON.parse(localStorage.getItem("favoriteMovies"));null!==e&&(myMovies=e,renderMyMovies())}btnSearch.disabled=!1;const removeMsg=()=>warnings.innerHTML="";function validateInput(){""===inputSearch.value?(btnSearch.disabled=!0,warnings.innerHTML="Introduce un título",setTimeout(removeMsg,3e3)):(btnSearch.disabled=!1,warnings.innerHTML="")}function notFound(){0===filmList.filter(e=>e.title.toLowerCase().includes(inputSearch.value.toLowerCase())).length?(warnings.innerHTML="Título no encontrado",setTimeout(removeMsg,3e3)):warnings.innerHTML="",clearInputSearch()}function listenerFilm(){const e=document.querySelectorAll(".js-filmCard");for(const i of e)i.addEventListener("click",handleClickFilm)}function listenerFavorites(){const e=document.querySelectorAll(".js-favCard");for(const i of e)i.addEventListener("click",handleClickFavorite)}function pressEnter(e){if(13===e.keyCode)return e.preventDefault(),validateInput(),!1===btnSearch.disabled&&callFetch(),!1}function clearInputSearch(){inputSearch.value=""}function handleClickSearch(e){e.preventDefault(),validateInput(),!1===btnSearch.disabled&&callFetch()}function handleClickResetInput(e){e.preventDefault(),clearInputSearch(),foundMovies.innerHTML=""}function handleClickFilm(e){const i=parseInt(e.currentTarget.id),n=filmList.find(e=>e.id===i);-1===myMovies.findIndex(e=>e.id===n.id)&&myMovies.push(n),renderFilmList(),renderMyMovies(),saveMyFavorites()}function handleClickFavorite(e){const i=parseInt(e.currentTarget.id),n=myMovies.findIndex(e=>e.id===i);myMovies.splice(n,1),renderFilmList(),renderMyMovies(),saveMyFavorites()}btnResetSearch.addEventListener("click",handleClickResetInput),btnSearch.addEventListener("click",handleClickSearch),btnRemoveMyMovies.addEventListener("click",removeMyFavorites),inputSearch.addEventListener("keydown",pressEnter),loadMyFavorites();